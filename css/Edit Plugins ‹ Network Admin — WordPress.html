<!DOCTYPE html>
<!-- saved from url=(0134)http://23.21.180.28/wp-admin/network/plugin-editor.php?file=movable-type-backup-importer/class-mt-backup-import.php&a=te&scrollto=3508 -->
<html xmlns="http://www.w3.org/1999/xhtml" class="wp-toolbar" lang="en-US"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Edit Plugins ‹ Network Admin — WordPress</title>
<script type="text/javascript">
addLoadEvent = function(func){if(typeof jQuery!="undefined")jQuery(document).ready(func);else if(typeof wpOnload!='function'){wpOnload=func;}else{var oldonload=wpOnload;wpOnload=function(){oldonload();func();}}};
var ajaxurl = '/wordpress/wp-admin/admin-ajax.php',
	pagenow = 'plugin-editor-network',
	typenow = '',
	adminpage = 'plugin-editor-php',
	thousandsSeparator = ',',
	decimalPoint = '.',
	isRtl = 0;
</script>
<link rel="stylesheet" href="./Edit Plugins ‹ Network Admin — WordPress_files/load-styles.php" type="text/css" media="all">
<link rel="stylesheet" id="colors-css" href="./Edit Plugins ‹ Network Admin — WordPress_files/colors-fresh.min.css" type="text/css" media="all">
<!--[if lte IE 7]>
<link rel='stylesheet' id='ie-css'  href='http://23.21.180.28/wordpress/wp-admin/css/ie.min.css?ver=3.5.1' type='text/css' media='all' />
<![endif]-->
<link rel="stylesheet" id="MS_style-css" href="./Edit Plugins ‹ Network Admin — WordPress_files/style.css" type="text/css" media="all">
<script type="text/javascript">pf_nonce='e1afdf5680';</script><script type="text/javascript">pf_nonce='e1afdf5680';</script>
<script type="text/javascript">
/* <![CDATA[ */
var userSettings = {"url":"\/","uid":"1","time":"1361770257"};/* ]]> */
</script>
<script type="text/javascript" src="./Edit Plugins ‹ Network Admin — WordPress_files/load-scripts.php"></script>
<script type="text/javascript" src="./Edit Plugins ‹ Network Admin — WordPress_files/msjs.js"></script>
<style type="text/css"> 
			#adminmenu #toplevel_page_edit-post_type-acf a[href="edit.php?post_type=acf&page=acf-upgrade"]{ display:none; }
			#adminmenu #toplevel_page_edit-post_type-acf .wp-menu-image { background-position: 1px -33px; }
			#adminmenu #toplevel_page_edit-post_type-acf:hover .wp-menu-image,
			#adminmenu #toplevel_page_edit-post_type-acf.wp-menu-open .wp-menu-image { background-position: 1px -1px; }
		</style><script type="text/javascript">
jQuery(function($) {
    // fix menu
    var mc = $('#menu-comments');
    mc.find('a.wp-has-submenu').attr('href', 'edit-comments.php?page=disqus').end().find('.wp-submenu  li:has(a[href="edit-comments.php?page=disqus"])').prependTo(mc.find('.wp-submenu ul'));
    // fix admin bar
    $('#wp-admin-bar-comments').find('a.ab-item').attr('href', 'edit-comments.php?page=disqus');
});
</script>
<style type="text/css" media="print">#wpadminbar { display:none; }</style>
</head>
<body class="wp-admin wp-core-ui js  plugin-editor-php auto-fold admin-bar branch-3-5 version-3-5-1 admin-color-fresh locale-en-us no-customize-support">
<script type="text/javascript">
	document.body.className = document.body.className.replace('no-js','js');
</script>


<div id="wpwrap">
<a tabindex="1" href="http://23.21.180.28/wp-admin/network/plugin-editor.php?file=movable-type-backup-importer/class-mt-backup-import.php&a=te&scrollto=3508#wpbody-content" class="screen-reader-shortcut">Skip to main content</a>

<div id="adminmenuback"></div>
<div id="adminmenuwrap">
<div id="adminmenushadow"></div>
<ul id="adminmenu" role="navigation">


	<li class="wp-first-item wp-not-current-submenu menu-top menu-top-first menu-icon-dashboard menu-top-last" id="menu-dashboard">
	<a href="http://23.21.180.28/wp-admin/network/index.php" class="wp-first-item wp-not-current-submenu menu-top menu-top-first menu-icon-dashboard menu-top-last"><div class="wp-menu-arrow"><div></div></div><div class="wp-menu-image"><br></div><div class="wp-menu-name">Dashboard</div></a></li>
	<li class="wp-not-current-submenu wp-menu-separator"><div class="separator"></div></li>
	<li class="wp-has-submenu wp-not-current-submenu menu-top menu-icon-site menu-top-first" id="menu-site">
	<a href="http://23.21.180.28/wp-admin/network/sites.php" class="wp-has-submenu wp-not-current-submenu menu-top menu-icon-site menu-top-first" aria-haspopup="true"><div class="wp-menu-arrow"><div></div></div><div class="wp-menu-image"><br></div><div class="wp-menu-name">Sites</div></a>
	<ul class="wp-submenu wp-submenu-wrap"><li class="wp-submenu-head">Sites</li><li class="wp-first-item"><a href="http://23.21.180.28/wp-admin/network/sites.php" class="wp-first-item">All Sites</a></li><li><a href="http://23.21.180.28/wp-admin/network/site-new.php">Add New</a></li></ul></li>
	<li class="wp-has-submenu wp-not-current-submenu menu-top menu-icon-users" id="menu-users">
	<a href="http://23.21.180.28/wp-admin/network/users.php" class="wp-has-submenu wp-not-current-submenu menu-top menu-icon-users" aria-haspopup="true"><div class="wp-menu-arrow"><div></div></div><div class="wp-menu-image"><br></div><div class="wp-menu-name">Users</div></a>
	<ul class="wp-submenu wp-submenu-wrap"><li class="wp-submenu-head">Users</li><li class="wp-first-item"><a href="http://23.21.180.28/wp-admin/network/users.php" class="wp-first-item">All Users</a></li><li><a href="http://23.21.180.28/wp-admin/network/user-new.php">Add New</a></li></ul></li>
	<li class="wp-has-submenu wp-not-current-submenu menu-top menu-icon-appearance" id="menu-appearance">
	<a href="http://23.21.180.28/wp-admin/network/themes.php" class="wp-has-submenu wp-not-current-submenu menu-top menu-icon-appearance" aria-haspopup="true"><div class="wp-menu-arrow"><div></div></div><div class="wp-menu-image"><br></div><div class="wp-menu-name">Themes</div></a>
	<ul class="wp-submenu wp-submenu-wrap"><li class="wp-submenu-head">Themes</li><li class="wp-first-item"><a href="http://23.21.180.28/wp-admin/network/themes.php" class="wp-first-item">Installed Themes</a></li><li><a href="http://23.21.180.28/wp-admin/network/theme-install.php">Add New</a></li><li><a href="http://23.21.180.28/wp-admin/network/theme-editor.php">Editor</a></li></ul></li>
	<li class="wp-has-submenu wp-has-current-submenu wp-menu-open menu-top menu-icon-plugins" id="menu-plugins">
	<a href="http://23.21.180.28/wp-admin/network/plugins.php" class="wp-has-submenu wp-has-current-submenu wp-menu-open menu-top menu-icon-plugins"><div class="wp-menu-arrow"><div></div></div><div class="wp-menu-image"><br></div><div class="wp-menu-name">Plugins <span class="update-plugins count-0"><span class="plugin-count">0</span></span></div></a>
	<ul class="wp-submenu wp-submenu-wrap"><li class="wp-submenu-head">Plugins <span class="update-plugins count-0"><span class="plugin-count">0</span></span></li><li class="wp-first-item"><a href="http://23.21.180.28/wp-admin/network/plugins.php" class="wp-first-item">Installed Plugins</a></li><li><a href="http://23.21.180.28/wp-admin/network/plugin-install.php">Add New</a></li><li class="current"><a href="http://23.21.180.28/wp-admin/network/plugin-editor.php" class="current">Editor</a></li></ul></li>
	<li class="wp-has-submenu wp-not-current-submenu menu-top menu-icon-settings" id="menu-settings">
	<a href="http://23.21.180.28/wp-admin/network/settings.php" class="wp-has-submenu wp-not-current-submenu menu-top menu-icon-settings" aria-haspopup="true"><div class="wp-menu-arrow"><div></div></div><div class="wp-menu-image"><br></div><div class="wp-menu-name">Settings</div></a>
	<ul class="wp-submenu wp-submenu-wrap"><li class="wp-submenu-head">Settings</li><li class="wp-first-item"><a href="http://23.21.180.28/wp-admin/network/settings.php" class="wp-first-item">Network Settings</a></li><li><a href="http://23.21.180.28/wp-admin/network/setup.php">Network Setup</a></li></ul></li>
	<li class="wp-has-submenu wp-not-current-submenu menu-top menu-icon-tools menu-top-last" id="menu-update">
	<a href="http://23.21.180.28/wp-admin/network/update-core.php" class="wp-has-submenu wp-not-current-submenu menu-top menu-icon-tools menu-top-last" aria-haspopup="true"><div class="wp-menu-arrow"><div></div></div><div class="wp-menu-image"><br></div><div class="wp-menu-name">Updates</div></a>
	<ul class="wp-submenu wp-submenu-wrap"><li class="wp-submenu-head">Updates</li><li class="wp-first-item"><a href="http://23.21.180.28/wp-admin/network/update-core.php" class="wp-first-item">Available Updates</a></li><li><a href="http://23.21.180.28/wp-admin/network/upgrade.php">Update Network</a></li></ul></li>
	<li class="wp-not-current-submenu wp-menu-separator-last"><div class="separator"></div></li><li id="collapse-menu" class="hide-if-no-js"><div id="collapse-button"><div></div></div><span>Collapse menu</span></li></ul>
</div>
<div id="wpcontent">

		<div id="wpadminbar" class="" role="navigation">
			<a class="screen-reader-shortcut" href="http://23.21.180.28/wp-admin/network/plugin-editor.php?file=movable-type-backup-importer/class-mt-backup-import.php&a=te&scrollto=3508#wp-toolbar" tabindex="1">Skip to toolbar</a>
			<div class="quicklinks" id="wp-toolbar" role="navigation" aria-label="Top navigation toolbar." tabindex="0">
				<ul id="wp-admin-bar-root-default" class="ab-top-menu">
		<li id="wp-admin-bar-wp-logo" class="menupop"><a class="ab-item" aria-haspopup="true" href="http://23.21.180.28/wp-admin/network/about.php" title="About WordPress"><span class="ab-icon"></span></a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-wp-logo-default" class="ab-submenu">
		<li id="wp-admin-bar-about"><a class="ab-item" href="http://23.21.180.28/wp-admin/network/about.php">About WordPress</a>		</li></ul><ul id="wp-admin-bar-wp-logo-external" class="ab-sub-secondary ab-submenu">
		<li id="wp-admin-bar-wporg"><a class="ab-item" href="http://wordpress.org/">WordPress.org</a>		</li>
		<li id="wp-admin-bar-documentation"><a class="ab-item" href="http://codex.wordpress.org/">Documentation</a>		</li>
		<li id="wp-admin-bar-support-forums"><a class="ab-item" href="http://wordpress.org/support/">Support Forums</a>		</li>
		<li id="wp-admin-bar-feedback"><a class="ab-item" href="http://wordpress.org/support/forum/requests-and-feedback">Feedback</a>		</li></ul></div>		</li>
		<li id="wp-admin-bar-my-sites" class="menupop"><a class="ab-item" aria-haspopup="true" href="http://23.21.180.28/wordpress/wp-admin/my-sites.php">My Sites</a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-my-sites-super-admin" class="ab-submenu">
		<li id="wp-admin-bar-network-admin" class="menupop"><a class="ab-item" aria-haspopup="true" href="http://23.21.180.28/wp-admin/network/">Network Admin</a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-network-admin-default" class="ab-submenu">
		<li id="wp-admin-bar-network-admin-d"><a class="ab-item" href="http://23.21.180.28/wp-admin/network/">Dashboard</a>		</li>
		<li id="wp-admin-bar-network-admin-s"><a class="ab-item" href="http://23.21.180.28/wp-admin/network/sites.php">Sites</a>		</li>
		<li id="wp-admin-bar-network-admin-u"><a class="ab-item" href="http://23.21.180.28/wp-admin/network/users.php">Users</a>		</li>
		<li id="wp-admin-bar-network-admin-v"><a class="ab-item" href="http://23.21.180.28/">Visit Network</a>		</li></ul></div>		</li></ul><ul id="wp-admin-bar-my-sites-list" class="ab-sub-secondary ab-submenu">
		<li id="wp-admin-bar-blog-1" class="menupop"><a class="ab-item" aria-haspopup="true" href="http://23.21.180.28/wordpress/wp-admin/"><div class="blavatar"></div>Sandbox</a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-blog-1-default" class="ab-submenu">
		<li id="wp-admin-bar-blog-1-d"><a class="ab-item" href="http://23.21.180.28/wordpress/wp-admin/">Dashboard</a>		</li>
		<li id="wp-admin-bar-blog-1-n"><a class="ab-item" href="http://23.21.180.28/wordpress/wp-admin/post-new.php">New Post</a>		</li>
		<li id="wp-admin-bar-blog-1-c"><a class="ab-item" href="http://23.21.180.28/wordpress/wp-admin/edit-comments.php">Manage Comments</a>		</li>
		<li id="wp-admin-bar-blog-1-v"><a class="ab-item" href="http://23.21.180.28/">Visit Site</a>		</li></ul></div>		</li>
		<li id="wp-admin-bar-blog-2" class="menupop"><a class="ab-item" aria-haspopup="true" href="http://23.21.180.28/mediashiftOLD/wp-admin/"><div class="blavatar"></div>MediaShift</a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-blog-2-default" class="ab-submenu">
		<li id="wp-admin-bar-blog-2-d"><a class="ab-item" href="http://23.21.180.28/mediashiftOLD/wp-admin/">Dashboard</a>		</li>
		<li id="wp-admin-bar-blog-2-n"><a class="ab-item" href="http://23.21.180.28/mediashiftOLD/wp-admin/post-new.php">New Post</a>		</li>
		<li id="wp-admin-bar-blog-2-c"><a class="ab-item" href="http://23.21.180.28/mediashiftOLD/wp-admin/edit-comments.php">Manage Comments</a>		</li>
		<li id="wp-admin-bar-blog-2-v"><a class="ab-item" href="http://23.21.180.28/mediashiftOLD/">Visit Site</a>		</li></ul></div>		</li>
		<li id="wp-admin-bar-blog-3" class="menupop"><a class="ab-item" aria-haspopup="true" href="http://23.21.180.28/idealab/wp-admin/"><div class="blavatar"></div>MediaShift Idea Lab</a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-blog-3-default" class="ab-submenu">
		<li id="wp-admin-bar-blog-3-d"><a class="ab-item" href="http://23.21.180.28/idealab/wp-admin/">Dashboard</a>		</li>
		<li id="wp-admin-bar-blog-3-n"><a class="ab-item" href="http://23.21.180.28/idealab/wp-admin/post-new.php">New Post</a>		</li>
		<li id="wp-admin-bar-blog-3-c"><a class="ab-item" href="http://23.21.180.28/idealab/wp-admin/edit-comments.php">Manage Comments</a>		</li>
		<li id="wp-admin-bar-blog-3-v"><a class="ab-item" href="http://23.21.180.28/idealab/">Visit Site</a>		</li></ul></div>		</li>
		<li id="wp-admin-bar-blog-4" class="menupop"><a class="ab-item" aria-haspopup="true" href="http://23.21.180.28/mediashift/wp-admin/"><div class="blavatar"></div>MediaShift</a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-blog-4-default" class="ab-submenu">
		<li id="wp-admin-bar-blog-4-d"><a class="ab-item" href="http://23.21.180.28/mediashift/wp-admin/">Dashboard</a>		</li>
		<li id="wp-admin-bar-blog-4-n"><a class="ab-item" href="http://23.21.180.28/mediashift/wp-admin/post-new.php">New Post</a>		</li>
		<li id="wp-admin-bar-blog-4-c"><a class="ab-item" href="http://23.21.180.28/mediashift/wp-admin/edit-comments.php">Manage Comments</a>		</li>
		<li id="wp-admin-bar-blog-4-v"><a class="ab-item" href="http://23.21.180.28/mediashift/">Visit Site</a>		</li></ul></div>		</li></ul></div>		</li>
		<li id="wp-admin-bar-site-name" class="menupop"><a class="ab-item" aria-haspopup="true" href="http://23.21.180.28/">Network Admin: MediaShift Sites</a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-site-name-default" class="ab-submenu">
		<li id="wp-admin-bar-view-site"><a class="ab-item" href="http://23.21.180.28/">Visit Site</a>		</li></ul></div>		</li></ul><ul id="wp-admin-bar-top-secondary" class="ab-top-secondary ab-top-menu">
		<li id="wp-admin-bar-my-account" class="menupop with-avatar"><a class="ab-item" aria-haspopup="true" href="http://23.21.180.28/wp-admin/network/profile.php" title="My Account">Howdy, slifty<img alt="" src="./Edit Plugins ‹ Network Admin — WordPress_files/d60161b5a7b5ad8de7bd71fb3b83c544" class="avatar avatar-16 photo" height="16" width="16"></a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-user-actions" class="ab-submenu">
		<li id="wp-admin-bar-user-info"><a class="ab-item" tabindex="-1" href="http://23.21.180.28/wp-admin/network/profile.php"><img alt="" src="./Edit Plugins ‹ Network Admin — WordPress_files/d60161b5a7b5ad8de7bd71fb3b83c544(1)" class="avatar avatar-64 photo" height="64" width="64"><span class="display-name">slifty</span></a>		</li>
		<li id="wp-admin-bar-edit-profile"><a class="ab-item" href="http://23.21.180.28/wp-admin/network/profile.php">Edit My Profile</a>		</li>
		<li id="wp-admin-bar-logout"><a class="ab-item" href="http://23.21.180.28/wordpress/wp-login.php?action=logout&_wpnonce=40e4df461c">Log Out</a>		</li></ul></div>		</li></ul>			</div>
			<a class="screen-reader-shortcut" href="http://23.21.180.28/wordpress/wp-login.php?action=logout&_wpnonce=40e4df461c">Log Out</a>
		</div>

		
<div id="wpbody">

<div id="wpbody-content" aria-label="Main content" tabindex="0">
		<div id="screen-meta" class="metabox-prefs">

			<div id="contextual-help-wrap" class="hidden" tabindex="-1" aria-label="Contextual Help Tab">
				<div id="contextual-help-back"></div>
				<div id="contextual-help-columns">
					<div class="contextual-help-tabs">
						<ul>
						
							<li id="tab-link-overview" class="active">
								<a href="http://23.21.180.28/wp-admin/network/plugin-editor.php?file=movable-type-backup-importer/class-mt-backup-import.php&a=te&scrollto=3508#tab-panel-overview" aria-controls="tab-panel-overview">
									Overview								</a>
							</li>
												</ul>
					</div>

										<div class="contextual-help-sidebar">
						<p><strong>For more information:</strong></p><p><a href="http://codex.wordpress.org/Plugins_Editor_Screen" target="_blank">Documentation on Editing Plugins</a></p><p><a href="http://codex.wordpress.org/Writing_a_Plugin" target="_blank">Documentation on Writing Plugins</a></p><p><a href="http://wordpress.org/support/" target="_blank">Support Forums</a></p>					</div>
					
					<div class="contextual-help-tabs-wrap">
						
							<div id="tab-panel-overview" class="help-tab-content active">
								<p>You can use the editor to make changes to any of your plugins’ individual PHP files. Be aware that if you make changes, plugins updates will overwrite your customizations.</p><p>Choose a plugin to edit from the menu in the upper right and click the Select button. Click once on any file name to load it in the editor, and make your changes. Don’t forget to save your changes (Update File) when you’re finished.</p><p>The Documentation menu below the editor lists the PHP functions recognized in the plugin file. Clicking Lookup takes you to a web page about that particular function.</p><p id="newcontent-description">In the editing area the Tab key enters a tab character. To move below this area by pressing Tab, press the Esc key followed by the Tab key.</p><p>If you want to make changes but don’t want them to be overwritten when the plugin is updated, you may be ready to think about writing your own plugin. For information on how to edit plugins, write your own from scratch, or just better understand their anatomy, check out the links below.</p><p>Any edits to files from this screen will be reflected on all sites in the network.</p>							</div>
											</div>
				</div>
			</div>
				</div>
				<div id="screen-meta-links">
					<div id="contextual-help-link-wrap" class="hide-if-no-js screen-meta-toggle">
			<a href="http://23.21.180.28/wp-admin/network/plugin-editor.php?file=movable-type-backup-importer/class-mt-backup-import.php&a=te&scrollto=3508#contextual-help-wrap" id="contextual-help-link" class="show-settings" aria-controls="contextual-help-wrap" aria-expanded="false">Help</a>
			</div>
				</div>
		 
<div class="wrap">
<div id="icon-plugins" class="icon32"><br></div><h2>Edit Plugins</h2><div id="message" class="updated"><p>File edited successfully.</p></div>

<div class="fileedit-sub">
<div class="alignleft">
<big>Editing <strong>movable-type-backup-importer/class-mt-backup-import.php</strong> (inactive)</big>
</div>
<div class="alignright">
	<form action="http://23.21.180.28/wp-admin/network/plugin-editor.php" method="post">
		<strong><label for="plugin">Select plugin to edit: </label></strong>
		<select name="plugin" id="plugin">

	<option value="acf-master/acf.php">Advanced Custom Fields</option>
	<option value="display-widgets/display-widgets.php">Display widgets</option>
	<option value="disqus-comment-system/disqus.php">Disqus Comment System</option>
	<option value="movabletype-importer/movabletype-importer.php">Movable Type and TypePad Importer</option>
	<option value="movable-type-backup-importer/movable-type-backup-importer.php">Movable Type Backup Importer</option>
	<option value="multiple-sidebars/multiple-sidebars.php">Multiple Sidebars</option>
	<option value="user-meta/user-meta.php">User Meta</option>		</select>
		<input type="submit" name="Submit" id="Submit" class="button" value="Select">	</form>
</div>
<br class="clear">
</div>

<div id="templateside">
	<h3>Plugin Files</h3>

	<ul>
		<li class="highlight"><a href="http://23.21.180.28/wp-admin/network/plugin-editor.php?file=movable-type-backup-importer%2Fclass-mt-backup-import.php&plugin=movable-type-backup-importer%2Fclass-mt-backup-import.php">movable-type-backup-importer/class-mt-backup-import.php</a></li>
		<li><a href="http://23.21.180.28/wp-admin/network/plugin-editor.php?file=movable-type-backup-importer%2Freadme.txt&plugin=movable-type-backup-importer%2Fclass-mt-backup-import.php">movable-type-backup-importer/readme.txt</a></li>
		<li><a href="http://23.21.180.28/wp-admin/network/plugin-editor.php?file=movable-type-backup-importer%2Fmovable-type-backup-importer.php&plugin=movable-type-backup-importer%2Fclass-mt-backup-import.php">movable-type-backup-importer/movable-type-backup-importer.php</a></li>
		<li><a href="http://23.21.180.28/wp-admin/network/plugin-editor.php?file=movable-type-backup-importer%2Fgpl-2.0.txt&plugin=movable-type-backup-importer%2Fclass-mt-backup-import.php">movable-type-backup-importer/gpl-2.0.txt</a></li>
	</ul>
</div>
<form name="template" id="template" action="http://23.21.180.28/wp-admin/network/plugin-editor.php" method="post">
	<input type="hidden" id="_wpnonce" name="_wpnonce" value="464942e384"><input type="hidden" name="_wp_http_referer" value="/wp-admin/network/plugin-editor.php?file=movable-type-backup-importer/class-mt-backup-import.php&amp;a=te&amp;scrollto=3508">		<div><textarea cols="70" rows="25" name="newcontent" id="newcontent" aria-describedby="newcontent-description">&lt;?php

/**
 * Movable Type Backup Importer
 *
 * @package WordPress
 * @subpackage Importer
 */
class MT_Backup_Import extends WP_Importer {
	
	private $_elements = array(
		array('id' =&gt; 'author', 'label' =&gt; 'Users'),
		array('id' =&gt; 'image', 'label' =&gt; 'Images'),
		array('id' =&gt; 'file', 'label' =&gt; 'Files'),
		array('id' =&gt; 'entry', 'label' =&gt; 'Posts'),
		array('id' =&gt; 'tag', 'label' =&gt; 'Tags'),
		array('id' =&gt; 'category', 'label' =&gt; 'Categories'),
		array('id' =&gt; 'comment', 'label' =&gt; 'Comments'),
		array('id' =&gt; 'trackback', 'label' =&gt; 'Trackbacks'),
	);
	
	private $_siteurl;
	private $_path;
	private $_autosizing = false;
	private $_content_width_upscale = 500;
	private $_content_width = 550;
    private $_slug_separator = '-'; // TODO: check _
    private $_broken = array();
    private $_uploadurl = '';
	
	function MT_Backup_Import() {
		// NOOP
	}
	
	function header() {
		echo '&lt;div class="wrap"&gt;';
		screen_icon();
		echo '&lt;h2&gt;'.__('Import Movable Type Backup', PLUGIN_ID).'&lt;/h2&gt;';
	}

	function footer() {
		echo '&lt;/div&gt;';
	}

	function greet() {
		$this-&gt;header();
		$directory = wp_upload_dir();
        if ($directory['error'] != '') {
            echo '&lt;div id="message" class="error"&gt;&lt;p&gt;&lt;strong&gt;' . $directory['error'] . '&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;';
            $this-&gt;footer();
            return;
        }
		$basedir = $directory['basedir'];

        // if it's just a one file backup, we simulate multifile backup
        $backups = glob($basedir . '/import/Movable_Type-*-Backup.xml');
        if (sizeof($backups) == 1) {
            $file = $backups[0];
            rename($file, substr($file,0,-4) . '-1.xml');
        }

		$backups = glob($basedir . '/import/Movable_Type-*-Backup-1.xml');
        if (!is_dir($basedir . '/import')) {
            $result = @mkdir($basedir . '/import', 0777, true);
            if (!$result) {
                echo '&lt;div id="message" class="error"&gt;&lt;p&gt;Unable to create &lt;strong&gt;' . $basedir . '/import&lt;/strong&gt;. Please create it by yourself&lt;/div&gt;';
                $this-&gt;footer();
                return;
            }
        }
		
		if (sizeof($backups) &gt; 0) {
		?&gt;
		&lt;h3&gt;Choose Backup to Import&lt;/h3&gt;
		&lt;div class="narrow"&gt;
		&lt;p&gt;&lt;?php _e('Nice! There are backups in the correct directory. Let\'s start by choosing a backup to import.') ?&gt;&lt;/p&gt;
		&lt;form method="post" action="&lt;?php echo esc_attr(add_query_arg('step', 1)); ?&gt;"&gt;
		&lt;?php wp_nonce_field('import-mt-backup'); ?&gt;
		&lt;p&gt;
		 &lt;ul&gt;
		  &lt;?php foreach($backups as $index =&gt; $backup) { 
		  $filename = basename($backup);
		  ?&gt;
		  &lt;li&gt;
		   &lt;input type="checkbox" id="backup-&lt;?php echo $index; ?&gt;" &lt;?php if($index == 0) { ?&gt;checked="checked"&lt;?php } ?&gt; name="backup" value="&lt;?php echo $filename ?&gt;" /&gt;
		   &lt;label for="backup-&lt;?php echo $index; ?&gt;"&gt;&lt;i&gt;&lt;?php echo $filename ?&gt;&lt;/i&gt;&lt;/label&gt;
		  &lt;/li&gt;
		  &lt;?php } ?&gt;
		 &lt;/ul&gt;
		&lt;/p&gt;
		&lt;h3&gt;&lt;?php _e('Which objects would you like to import?') ?&gt;&lt;/h3&gt;
		&lt;p&gt;
		 &lt;ul&gt;
		  &lt;?php foreach($this-&gt;_elements as $index =&gt; $element) { ?&gt;
		  &lt;li&gt;
		   &lt;input checked="checked" type="checkbox" disabled="disabled" id="element-&lt;?php echo $index; ?&gt;" name="elements[&lt;?php echo $index ?&gt;]" value="&lt;?php echo $element['id'] ?&gt;" /&gt;
		   &lt;label for="element-&lt;?php echo $index; ?&gt;"&gt;&lt;i&gt;&lt;?php echo $element['label'] ?&gt;&lt;/i&gt;&lt;/label&gt;
		  &lt;/li&gt;
		  &lt;?php } ?&gt;
		 &lt;/ul&gt;
		&lt;/p&gt;
		&lt;p class="submit"&gt;
		&lt;input type="submit" class="button" value="&lt;?php esc_attr_e('Import', PLUGIN_ID); ?&gt;" /&gt;
		&lt;/p&gt;
		&lt;/form&gt;
		&lt;/div&gt;
		
		&lt;?php } else { ?&gt;
		&lt;h3&gt;Upload Backup&lt;/h3&gt;
		&lt;div class="narrow"&gt;
		&lt;p&gt;
		 &lt;ul&gt;
		  &lt;li&gt;1. &lt;?php _e('Upload &lt;b&gt;unzipped&lt;/b&gt; backup to') ?&gt;: &lt;code&gt;&lt;?php echo $basedir ?&gt;/import&lt;/code&gt;&lt;/li&gt;
		  &lt;li&gt;2. &lt;code&gt;chmod -R 777 &lt;?php echo $basedir ?&gt;/import&lt;/code&gt;&lt;/li&gt;
		 &lt;/ul&gt;
	    &lt;/p&gt;
		&lt;form method="post" action="&lt;?php echo esc_attr(add_query_arg('step', 0)); ?&gt;"&gt;
		&lt;p class="submit"&gt;
		&lt;input type="submit" class="button" value="&lt;?php esc_attr_e('Refresh', PLUGIN_ID); ?&gt;" /&gt;
		&lt;/p&gt;
		&lt;/form&gt;
		&lt;/div&gt;
		&lt;?php
		}
		$this-&gt;footer();
	}
		
	function dispatch() {
		$step = empty($_GET['step']) ? 0 : (int) $_GET['step'];
		switch ($step) {
			case 0 :
				$this-&gt;greet();
				break;
			case 1:
				check_admin_referer('import-mt-backup');
				$result = $this-&gt;import();
				if (is_wp_error($result))
					echo $result-&gt;get_error_message();
				break;
		}
	}
	
	function import() {

        // set time limit to unlimited
		set_time_limit(0);
		
		// allow iframes and stuff
		// credits: http://wordpress.org/support/topic/bypass-sanitize_post-from-wp_insert_post
		kses_remove_filters();
		
		// disable automatic shortlink generation (because of performance reasons)
		define('DISABLE_SHORTLINK', true);
		
		// disable too much xml warnings
		if (function_exists('libxml_use_internal_errors')) {
			libxml_use_internal_errors(true);
		}
		
		// let's show the user some progress (to keep him happy, while importing)
		ob_implicit_flush(true);
		
		echo '&lt;h2&gt;Importing your Movable Type Backup&lt;/h2&gt;';
		echo '&lt;p&gt;Your backup will be processed in chunks if available.&lt;/p&gt;';
		$directory = wp_upload_dir();
		$basedir = $directory['basedir'] . '/import/';
		$this-&gt;_path = $basedir;
        $this-&gt;_uploadurl = $directory['baseurl'] . '/import/';
		
		// this is the path to the first backup file, but we need
		// to look for other chunks as well
		$backup = $_REQUEST['backup'];
		$basebackup = substr($backup, 0, -5);
		$chunks = glob($basedir . $basebackup . '*');
		$chunk_count = sizeof($chunks);
		
		// initialize mappings
		$mappings = array(
			'user' =&gt; array(), 
			'post' =&gt; array(),
			'assets' =&gt; array(),
			'tags' =&gt; array(),
			'categories' =&gt; array()
		);
		
		// process every single chunk file
		for ($i = 1; $i &lt;= $chunk_count; $i++) {
			$chunk_file = $basedir . $basebackup . $i . '.xml';
			if (is_file($chunk_file)) {
				echo "&lt;h3&gt;" . basename($chunk_file) . "&lt;/h3&gt;";
				$this-&gt;_import_mt_backup_file($basedir, basename($chunk_file), $mappings);
			}
		}
	}
	
	function _import_mt_backup_file($basedir, $backup, &amp;$mappings) {
		
		// cleanup xml file before import
		$content = file_get_contents($basedir . $backup);
		
		// remove bad characters
		$content = str_replace(array("", ""), array("",""), $content);
		
		// remove unused log entries
		$content = preg_replace("%(&lt;log.*?&gt;.*?&lt;\/log.*?&gt;)%is", '', $content);
		
		// write temporary clean xml file
		file_put_contents($basedir . 'clean-' . $backup, $content);
		unset($content);
		
		// start import
		$this-&gt;_import_mt($basedir, 'clean-' . $backup, $mappings);
		
	}

	function _import_mt($path, $backup, &amp;$mappings) {
		$backupxml = $path . $backup;
		echo '&lt;p&gt;Importing &lt;code&gt;' . $backupxml . '&lt;/code&gt;...&lt;/p&gt;';
		if (is_file($backupxml)) {
			$xmlfile= file_get_contents($backupxml);
			$xml = simplexml_load_file($xmlfile);
			print_r(libxml_get_errors());
			exit();
			$nodes = $xml-&gt;children();
			foreach ($nodes as $name =&gt; $node) {
				switch ($name) {
					case 'author': $this-&gt;_import_mt_user($path, $node, $mappings); break;
					case 'blog': $this-&gt;_import_mt_blog($path, $node, $mappings); break;
					case 'entry': $this-&gt;_import_mt_post($path, $node, $mappings); break;
					case 'image': $this-&gt;_import_mt_image($path, $node, $mappings); break;
					case 'file': $this-&gt;_import_mt_file($path, $node, $mappings); break;
					case 'tag': $this-&gt;_import_mt_tag($path, $node, $mappings); break;
					case 'placement': $this-&gt;_import_mt_placement($path, $node, $mappings); break;
					case 'category': $this-&gt;_import_mt_category($path, $node, $mappings); break;
					case 'objecttag': $this-&gt;_import_mt_objecttag($path, $node, $mappings); break;
					case 'objectasset': $this-&gt;_import_mt_objectasset($path, $node, $mappings); break;
					case 'comment': $this-&gt;_import_mt_comment($path, $node, $mappings); break;
					// case 'trackback': $this-&gt;_import_mt_trackback($path, $node, $mappings); break;
				}
			}
		}
	}
	
	function _import_mt_blog($path, $blog, &amp;$mappings) {
		$this-&gt;_siteurl = $blog-&gt;attributes()-&gt;site_url;
	}

	function _import_mt_user($path, $user, &amp;$mappings) {

		$id = (string) $user-&gt;attributes()-&gt;id;
		$email = (string) $user-&gt;attributes()-&gt;email;
		$username = (string) $user-&gt;attributes()-&gt;name;
		$nickname = (string) $user-&gt;attributes()-&gt;nickname;
		$status = (string) $user-&gt;attributes()-&gt;status; // 1 = Active, 2 = Inactive
		$password = (string) $user-&gt;attributes()-&gt;password;
		$password = strlen($password) &gt; 0 ? $password : wp_generate_password();
		$created = (string) $user-&gt;attributes()-&gt;created_on;
		$role = $status == 1 ? 'editor' : 'subscriber';

		$data = array(
			'user_pass' =&gt; $password,
			'user_login' =&gt; $username,
			'user_email' =&gt; strtolower($email),
			'display_name' =&gt; $nickname,
			'user_registered' =&gt; date('Y-m-d H:i:s', strtotime($created)),
			'role' =&gt; $role
		);
		
		// Users with "ldaprename" prefix are not handled correctly
		if (substr($username,0,10) == 'ldaprename') {
			$user_id = username_exists(substr($username,10));
			if ($user_id !== null) {
				// user already exists, perfect, so nothing to do here, except updating our mapping
				// array for later use.
				$mappings['user'][(string)$id] = $user_id;
				return;
			} else {
                // If the username is just "ldaprename", we kick it
                if (strlen($username) &gt; 10) {
				    $data['user_login'] = strtolower(substr($username,10));
                } else {
                    return;
                }
			}
		}
		
		// if there is still no password, set a random one.
		// ldap user don't have passwords set, so we generate a random one to not
		// allow them to enter if something goes wrong with the ldap connection.
		if (trim($data['user_pass']) == '' || trim($data['user_pass']) == '(none)') {
			$data['user_pass'] = wp_generate_password();
		}

        if (function_exists('mt_import_user_data')) {
            mt_import_user_data($data);
        }

		// check if user already exists
		$user_id = username_exists($username);
		if (!$user_id) {
			$user_id = wp_insert_user($data);
		}
		
		// add author role to user for this blog
		global $current_blog;
		if (function_exists('add_user_to_blog')) {
			add_user_to_blog($current_blog-&gt;blog_id, $user_id, 'editor');
		}
		
		// add mapping
		$mappings['user'][(string)$id] = $user_id;
		
	}

	function _import_mt_asset($path, $asset, &amp;$mappings) {

		$id = (string) $asset-&gt;attributes()-&gt;id;
		$filename = (string) $asset-&gt;attributes()-&gt;file_name;
		$mimetype = (string) $asset-&gt;attributes()-&gt;mime_type;
		$label = (string) $asset-&gt;attributes()-&gt;label;
		$parent = (string) $asset-&gt;attributes()-&gt;parent;
		$entry_id = (string) $asset-&gt;attributes()-&gt;entry_id;
		$title = strlen($label) &gt; 0 ? $label : $filename;
		$author = (string) $asset-&gt;attributes()-&gt;created_by;

		// Skip, if it's a thumbnail
		if ($parent &gt; 0) {
			return;
		}

		$attachment = array(
		     'post_mime_type' =&gt; $mimetype,
		     'post_title' =&gt; preg_replace('/\.[^.]+$/', '', $title),
		     'post_content' =&gt; '',
		     'post_status' =&gt; 'inherit',
			 'post_author' =&gt; isset($mappings['user'][$author]) ? $mappings['user'][$author] : null,
		);

		$filepath = $path . '/' . $id . '-' . $filename;
		$attach_id = wp_insert_attachment($attachment, $filepath, null);
		require_once(ABSPATH . 'wp-admin/includes/image.php');
		$attach_data = wp_generate_attachment_metadata($attach_id, $filepath);
		wp_update_attachment_metadata($attach_id, $attach_data);
		$mappings['assets'][$id] = $attach_id;
	
	}
	
	function _import_mt_image($path, $post, &amp;$mappings) {
		$this-&gt;_import_mt_asset($path, $post, $mappings);
	}
	
	function _import_mt_file($path, $post, &amp;$mappings) {
		$this-&gt;_import_mt_asset($path, $post, $mappings);
	}

	function _import_mt_post($path, $post, &amp;$mappings) {

		$id = $post-&gt;attributes()-&gt;id;
		$allow_comments = $post-&gt;attributes()-&gt;allow_comments;
		$allow_pings = $post-&gt;attributes()-&gt;allow_pings;
		$atom_id = $post-&gt;attributes()-&gt;atom_id;
		$author_id = (string) $post-&gt;attributes()-&gt;author_id;
		$authored_on = date('Y-m-d H:i:s', strtotime($post-&gt;attributes()-&gt;authored_on));
		$basename = $post-&gt;attributes()-&gt;basename;
		$comment_count = $post-&gt;attributes()-&gt;comment_count;
		$class = $post-&gt;attributes()-&gt;class;
		$created_by = $post-&gt;attributes()-&gt;created_by;
		$created_on = date('Y-m-d H:i:s', strtotime($post-&gt;attributes()-&gt;created_on));
		$authored_on = date('Y-m-d H:i:s', strtotime($post-&gt;attributes()-&gt;authored_on));
		$modified_by = $post-&gt;attributes()-&gt;modified_by;
		$modified_on = date('Y-m-d H:i:s', strtotime($post-&gt;attributes()-&gt;modified_on));
		$ping_count = $post-&gt;attributes()-&gt;ping_count;
		$status = $post-&gt;attributes()-&gt;status;
		$title = $post-&gt;attributes()-&gt;title;
		$weeknumber = $post-&gt;attributes()-&gt;weeknumber;
		$content = (string) $post-&gt;text;
		$search = array();
		$replace = array();
		$preg_search = array();
		$preg_replace = array();

        // support for extended content
        if ('' != trim($post-&gt;text_more)) {
            $extended = (string) $post-&gt;text_more;
            $content = $content . "\n&lt;!--more--&gt;\n" . $extended;
        }

		if (strlen($content) &gt; 0) {
			// replace image tags
			$pattern = '/&lt;img.*?src="(.*?)"(.*?)&gt;/is';
			$content = preg_replace_callback($pattern, array('self', '_replace_mt_image'), $content);
			
			// replace links
			$pattern = '/&lt;a.*?href="(.*?)".*?&gt;(.*?)&lt;\/a&gt;/is';
			$content = preg_replace_callback($pattern, array('self', '_replace_mt_link'), $content);
		}

		$post = new StdClass;
		$post-&gt;post_content = $content;
		$post-&gt;post_author = isset($mappings['user'][$author_id]) ? $mappings['user'][$author_id] : null;
		$post-&gt;post_title = $title;
		$post-&gt;post_name = str_replace('_', $this-&gt;_slug_separator, $basename);
		$post-&gt;post_status = $status == 2 ? 'publish' : null; // TODO
		$post-&gt;post_modified = $modified_on;
		$post-&gt;post_modified_gmt = get_gmt_from_date($modified_on);
		$post-&gt;post_date = $authored_on;
		$post-&gt;post_date_gmt = get_gmt_from_date($authored_on);
		$post-&gt;ping_status = $allow_pings == 1 ? true : false;
		$post-&gt;comment_status = $allow_comments == 1 ? 'open' : 'closed';
		
		// Tell Wordpress that the content is already filtered to allow embed, iframe, etc.
		// Credits to: http://pp19dd.com/2010/06/unfiltered-wp_insert_post/
		$post-&gt;filter = true;
        $post_id = $this-&gt;_save_post($post);
        $mappings['posts'][(string)$id] = $post_id;

	}

	function _import_mt_tag($path, $tag, &amp;$mappings) {

		$id = $tag-&gt;attributes()-&gt;id;
		$n8d_id = $tag-&gt;attributes()-&gt;n8d_id;
		$name = $tag-&gt;attributes()-&gt;name;
		$mappings['tags'][(string)$id] = (string)$name;

	}

	function _import_mt_objecttag($path, $tag, &amp;$mappings) {

		$id = $tag-&gt;attributes()-&gt;id;
		$object_datasource = $tag-&gt;attributes()-&gt;object_datasource;
		$object_id = (string) $tag-&gt;attributes()-&gt;object_id;
		$tag_id = (string) $tag-&gt;attributes()-&gt;tag_id;

		if ($object_datasource == 'entry') {
			wp_add_post_tags($mappings['posts'][$object_id], $mappings['tags'][$tag_id]);
		}

	}

	function _import_mt_category($path, $category, &amp;$mappings) {

		$id = $category-&gt;attributes()-&gt;id;
		$allow_pings = $category-&gt;attributes()-&gt;allow_pings;
		$author_id = $category-&gt;attributes()-&gt;author_id;
		$basename = $category-&gt;attributes()-&gt;basename;
		$created_by = $category-&gt;attributes()-&gt;created_by;
		$created_on = $category-&gt;attributes()-&gt;created_on;
		$label = $category-&gt;attributes()-&gt;label;
		$modified_on = $category-&gt;attributes()-&gt;modified_on;
		$parent = $category-&gt;attributes()-&gt;parent;

		$data = array(
		  'cat_name' =&gt; $label,
		  'category_nicename' =&gt; $basename
		);
		$category = get_category_by_slug($basename);
		if (!$category) {
            $wp_error = array();
			$cat_id = wp_insert_category($data, $wp_error);
		} else {
			$cat_id = $category-&gt;cat_ID;
		}
		$mappings['categories'][(string)$id] = $cat_id;

	}

	function _import_mt_placement($path, $placement, &amp;$mappings) {

		$id = $placement-&gt;attributes()-&gt;id;
		$category_id = (string) $placement-&gt;attributes()-&gt;category_id;
		$post_id = (string) $placement-&gt;attributes()-&gt;entry_id;
		$is_primary = $placement-&gt;attributes()-&gt;is_primary; // 1 = true, 0 = false

		wp_set_post_categories($mappings['posts'][$post_id], array($mappings['categories'][$category_id]));

	}

	function _import_mt_objectasset($path, $objectasset, &amp;$mappings) {

		$id = (string) $objectasset-&gt;attributes()-&gt;id;
		$asset_id = (string) $objectasset-&gt;attributes()-&gt;asset_id;
		$embedded = (string) $objectasset-&gt;attributes()-&gt;embedded;
		$object_ds = (string) $objectasset-&gt;attributes()-&gt;object_ds;
		$object_id = (string) $objectasset-&gt;attributes()-&gt;object_id;
		if ($object_ds == 'entry') {
			wp_update_post(array('ID' =&gt; $mappings['assets'][$asset_id], 'post_parent' =&gt; $mappings['posts'][$object_id]));
		}

	}

	function _import_mt_comment($path, $comment, &amp;$mappings) {

		$id = (string) $comment-&gt;attributes()-&gt;id;
		$author = (string) $comment-&gt;attributes()-&gt;author;
		$created_on = date('Y-m-d H:i:s', strtotime($comment-&gt;attributes()-&gt;created_on));
		$entry_id = (string) $comment-&gt;attributes()-&gt;entry_id;
		$email = (string) $comment-&gt;attributes()-&gt;email;
		$url = (string) $comment-&gt;attributes()-&gt;url;
		$ip = (string) $comment-&gt;attributes()-&gt;ip;
		$junk_status = (string) $comment-&gt;attributes()-&gt;junk_status; // 1 = OK
		$last_moved_on = date('Y-m-d H:i:s', strtotime($comment-&gt;attributes()-&gt;last_moved_on));
		$visible = (string) $comment-&gt;attributes()-&gt;visible;
		$text = (string) $comment-&gt;text;

		if ($junk_status == 1) {
			$comment = array();
			$comment['comment_author'] = $author;
			$comment['comment_author_email'] = $email;
			$comment['comment_date'] = $created_on;
			$comment['comment_status'] = 'open';
			$comment['comment_author_IP'] = $ip;
			$comment['comment_author_url'] = $url;
			$comment['comment_content'] = $text;

			$comment = add_magic_quotes($comment);
			if (!comment_exists($comment['comment_author'], $comment['comment_date'])) {
				$comment['comment_post_ID'] = $mappings['posts'][$entry_id];
				$comment = wp_filter_comment($comment);
				wp_insert_comment($comment);
			}
		}

	}

	function _import_mt_trackback($path, $trackback, &amp;$mappings) {

		$id = (string) $trackback-&gt;attributes()-&gt;id;
		$created_by = (string) $trackback-&gt;attributes()-&gt;created_by;
		$created_on = date('Y-m-d H:i:s', strtotime($trackback-&gt;attributes()-&gt;created_on));
		$entry_id = (string) $trackback-&gt;attributes()-&gt;entry_id;
		$title = (string) $trackback-&gt;attributes()-&gt;email;
		$url = (string) $trackback-&gt;attributes()-&gt;url;
		$modified_on = date('Y-m-d H:i:s', strtotime($trackback-&gt;attributes()-&gt;modified_on));
		$is_disabled = (string) $trackback-&gt;attributes()-&gt;is_disabled;
		$text = (string) $trackback-&gt;description;

		$ping = array();
		$ping['comment_type'] = 'trackback';
		$ping['comment_author'] = $mappings['users'][$created_by];
		$ping['comment_date'] = $created_on;
		$ping['ping_status'] = 'open';
		$ping['comment_author_url'] = $url;
		$ping['comment_content'] = "&lt;strong&gt;{$ping['title']}&lt;/strong&gt;\n\n{$ping['comment_content']}";

		$ping = add_magic_quotes($ping);
		if (!comment_exists($ping['comment_author'], $ping['comment_date'])) {
			$ping['comment_post_ID'] = $mappings['posts'][$entry_id];
			$ping = wp_filter_comment($ping);
			wp_insert_comment($ping);
		}

	}

    function _download_broken_url($url) {
		$filename = 'i-' . md5($url) . '-' . urldecode(basename($url));
		if (!is_file($this-&gt;_uploadurl . $filename)) {
			echo "&lt;li&gt;Downloading broken resource: " . $url . "&lt;/li&gt;";
			$content = @file_get_contents($url);
			if ($content !== FALSE) {
				file_put_contents($this-&gt;_path . '/' . $filename, $content);
				return $this-&gt;_uploadurl . $filename;
			}
		} else {
			return $this-&gt;_uploadurl . $filename;
		}
		return null;
	}

    function _replace_mt_image($image) {
		$siteurl_length = strlen($this-&gt;_siteurl);
		if (substr($image[1], 0, $siteurl_length) == $this-&gt;_siteurl) {
			$filename = urldecode(basename($image[1]));
			$originals = glob($this-&gt;_path . '/*-' . $filename);

			// try to get original width and define new sizing
			preg_match_all('/width="(\d+)" height="(\d+)"/is', $image[2], $matches);
			$sizing = '';
			if (sizeof($matches[1]) &gt; 1) {
				$width = $matches[1][0];
				$height = $matches[1][1];
				$sizing = ' width="' . $width . '" height="' . $height . '"';
			}

			if (sizeof($originals) &gt; 0) {
				$new = basename($originals[0]);
				if ($this-&gt;_autosizing) {
					list($width, $height, $type, $attr) = getimagesize($originals[0]);
					if ($width &gt;= $this-&gt;_content_width_upscale) {
						$height = round($this-&gt;_content_width/($width/$height));
						$sizing = ' width="' . $this-&gt;_content_width . '" height="' . $height . '"';
					}
				}
				$replace = $this-&gt;_uploadurl . $new;
				return '&lt;img src="' . $replace. '" alt="' . $new . '"' . $sizing . ' /&gt;';
			} else {
				$url = $this-&gt;_download_broken_url($image[1]);
				if ($url === null) {
					echo "&lt;span style=\"color: red;\"&gt;BROKEN&lt;/span&gt;: " . $image[1] . "&lt;br /&gt;";
                    $this-&gt;_broken[] = array('type' =&gt; 'image', 'url' =&gt; $image[1]);
				} else {
					return '&lt;img src="' . $url. '" alt="' . basename($url) . '"' . $sizing . ' /&gt;';
				}
			}
		}
		return $image[0];
	}

	/**
	 * Replaces URLs in Links with the new one. If the link points to an HTML popup with an
	 * image (guessed), it will be removed. If the link points to image of the current domain,
	 * but it doesn't exist, the script tries to download the image and returns the correct
	 * link.
     *
     * @param $link Link URL
     * @return string corrected link markup
	 */
	function _replace_mt_link($link) {
		$siteurl_length = strlen($this-&gt;_siteurl);
		if (substr($link[1], 0, $siteurl_length) == $this-&gt;_siteurl) {
			$filename = urldecode(basename($link[1]));
			$originals = glob($this-&gt;_path . '/*-' . $filename);
			if (sizeof($originals) &gt; 0) {
				$new = basename($originals[0]);
				$replace = $this-&gt;_uploadurl . $new;
				if (strpos($link[1], 'assets_c') &gt; 0 &amp;&amp; substr($new,-5) == '.html') {
					return $link[2];
				} else {
					return '&lt;a href="' . $replace . '"&gt;' . $link[2] . '&lt;/a&gt;';
				}
			} else {
				$replace = str_replace($this-&gt;_siteurl, get_bloginfo('url') . '/', $link[1]);
				if (substr($replace, -5) == '.html' || strpos(basename($link[1]), '.') === false) {
					return '&lt;a href="' . $replace . '"&gt;' . $link[2] . '&lt;/a&gt;';
				}
				$url = $this-&gt;_download_broken_url($link[1]);
				if ($url === null) {
					echo "&lt;span style=\"color: red;\"&gt;BROKEN&lt;/span&gt;: " . $link[1] . "&lt;br /&gt;";
                    $this-&gt;_broken[] = array('type' =&gt; 'link', 'url' =&gt; $link[1]);
				} else {
					return '&lt;a href="' . $url . '"&gt;' . $link[2] . '&lt;/a&gt;';
				}
			}
		}
		return $link[0];

	}

	function _save_post(&amp;$post) {
		$post = get_object_vars($post);
		$post = add_magic_quotes($post);
		$post = (object) $post;

		if ( $post_id = post_exists($post-&gt;post_title, '', $post-&gt;post_date) ) {
			echo '&lt;li&gt;';
			printf(__('Post &lt;em&gt;%s&lt;/em&gt; already exists.', PLUGIN_ID), stripslashes($post-&gt;post_title));
		} else {
			echo '&lt;li&gt;';
			printf(__('Importing post &lt;em&gt;%s&lt;/em&gt;...', PLUGIN_ID), stripslashes($post-&gt;post_title));
			$post_id = wp_insert_post($post);
			if (is_wp_error($post_id)) {
				echo "ERROR";
				return $post_id;
			}
		}
		return $post_id;
	}
	
	function _get_blog_list() {
		global $wpdb;
		$blogs = $wpdb-&gt;get_results($wpdb-&gt;prepare("
			SELECT blog_id, domain, path 
			FROM $wpdb-&gt;blogs 
			WHERE 
				public = '1' AND 
				archived = '0' AND 
				mature = '0' AND 
				spam = '0' AND 
				deleted = '0' 
			ORDER BY registered DESC"
			), ARRAY_A
		);
	}
	
}

?&gt;</textarea>
		<input type="hidden" name="action" value="update">
		<input type="hidden" name="file" value="movable-type-backup-importer/class-mt-backup-import.php">
		<input type="hidden" name="plugin" value="movable-type-backup-importer/class-mt-backup-import.php">
		<input type="hidden" name="scrollto" id="scrollto" value="3508">
		</div>
				<div id="documentation" class="hide-if-no-js"><label for="docs-list">Documentation:</label> <select name="docs-list" id="docs-list"><option value="">Function Name…</option><option value="__">__()</option><option value="_e">_e()</option><option value="add_magic_quotes">add_magic_quotes()</option><option value="add_query_arg">add_query_arg()</option><option value="add_user_to_blog">add_user_to_blog()</option><option value="basename">basename()</option><option value="check_admin_referer">check_admin_referer()</option><option value="comment_exists">comment_exists()</option><option value="date">date()</option><option value="define">define()</option><option value="esc_attr">esc_attr()</option><option value="esc_attr_e">esc_attr_e()</option><option value="file_get_contents">file_get_contents()</option><option value="file_put_contents">file_put_contents()</option><option value="function_exists">function_exists()</option><option value="get_bloginfo">get_bloginfo()</option><option value="get_category_by_slug">get_category_by_slug()</option><option value="get_gmt_from_date">get_gmt_from_date()</option><option value="get_object_vars">get_object_vars()</option><option value="getimagesize">getimagesize()</option><option value="glob">glob()</option><option value="is_dir">is_dir()</option><option value="is_file">is_file()</option><option value="is_wp_error">is_wp_error()</option><option value="kses_remove_filters">kses_remove_filters()</option><option value="libxml_get_errors">libxml_get_errors()</option><option value="libxml_use_internal_errors">libxml_use_internal_errors()</option><option value="md5">md5()</option><option value="mkdir">mkdir()</option><option value="mt_import_user_data">mt_import_user_data()</option><option value="ob_implicit_flush">ob_implicit_flush()</option><option value="post_exists">post_exists()</option><option value="preg_match_all">preg_match_all()</option><option value="preg_replace">preg_replace()</option><option value="preg_replace_callback">preg_replace_callback()</option><option value="print_r">print_r()</option><option value="printf">printf()</option><option value="rename">rename()</option><option value="round">round()</option><option value="screen_icon">screen_icon()</option><option value="set_time_limit">set_time_limit()</option><option value="simplexml_load_file">simplexml_load_file()</option><option value="sizeof">sizeof()</option><option value="str_replace">str_replace()</option><option value="stripslashes">stripslashes()</option><option value="strlen">strlen()</option><option value="strpos">strpos()</option><option value="strtolower">strtolower()</option><option value="strtotime">strtotime()</option><option value="substr">substr()</option><option value="trim">trim()</option><option value="urldecode">urldecode()</option><option value="username_exists">username_exists()</option><option value="wp_add_post_tags">wp_add_post_tags()</option><option value="wp_filter_comment">wp_filter_comment()</option><option value="wp_generate_attachment_metadata">wp_generate_attachment_metadata()</option><option value="wp_generate_password">wp_generate_password()</option><option value="wp_insert_attachment">wp_insert_attachment()</option><option value="wp_insert_category">wp_insert_category()</option><option value="wp_insert_comment">wp_insert_comment()</option><option value="wp_insert_post">wp_insert_post()</option><option value="wp_insert_user">wp_insert_user()</option><option value="wp_nonce_field">wp_nonce_field()</option><option value="wp_set_post_categories">wp_set_post_categories()</option><option value="wp_update_attachment_metadata">wp_update_attachment_metadata()</option><option value="wp_update_post">wp_update_post()</option><option value="wp_upload_dir">wp_upload_dir()</option></select> <input type="button" class="button" value="Lookup " onclick="if ( &#39;&#39; != jQuery(&#39;#docs-list&#39;).val() ) { window.open( &#39;http://api.wordpress.org/core/handbook/1.0/?function=&#39; + escape( jQuery( &#39;#docs-list&#39; ).val() ) + &#39;&amp;locale=en_US&amp;version=3.5.1&amp;redirect=true&#39;); }"></div>
				<p class="submit">
	<input type="submit" name="submit" id="submit" class="button button-primary" value="Update File">	</p>
</form>
<br class="clear">
</div>
<script type="text/javascript">
jQuery(document).ready(function($){
	$('#template').submit(function(){ $('#scrollto').val( $('#newcontent').scrollTop() ); });
	$('#newcontent').scrollTop( $('#scrollto').val() );
});
</script>

<div class="clear"></div></div><!-- wpbody-content -->
<div class="clear"></div></div><!-- wpbody -->
<div class="clear"></div></div><!-- wpcontent -->

<div id="wpfooter">
<p id="footer-left" class="alignleft"><span id="footer-thankyou">Thank you for creating with <a href="http://wordpress.org/">WordPress</a>.</span></p>
<p id="footer-upgrade" class="alignright">Version 3.5.1</p>
<div class="clear"></div>
</div>

<script type="text/javascript">
/* <![CDATA[ */
var commonL10n = {"warnDelete":"You are about to permanently delete the selected items.\n  'Cancel' to stop, 'OK' to delete."};/* ]]> */
</script>
<script type="text/javascript" src="./Edit Plugins ‹ Network Admin — WordPress_files/load-scripts(1).php"></script>

<div class="clear"></div></div><!-- wpwrap -->
<script type="text/javascript">if(typeof wpOnload=='function')wpOnload();</script>


</body></html>